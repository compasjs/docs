
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
        <title>Release v0.0.119</title>
        <meta name="description" content="Release notes for Compas v0.0.119"/>
        <link rel="canonical" href="https://compasjs.com/releases/0.0.119.html"/>
        <style>
            body {margin: 5% auto; background: #f2f2f2; color: #444444; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.8; text-shadow: 0 1px 0 #ffffff; max-width: 73%;}
            pre, code {background: white;}
            pre {padding-left: 2px; line-height: 1.2; }
            code {margin-left: 2px; margin-right: 2px; }
            a {border-bottom: 1px solid #444444; color: #444444; text-decoration: none;}
            a:hover {border-bottom: 0;}
            a.anchor { float: right; text-decoration: none; padding: 1px 3px; border-bottom: none; }
            .hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs,.hljs-subst{color:#444}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#bc6060}.hljs-literal{color:#78a960}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta-string{color:#4d99bf}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}
        </style>
    </head>
    <body>
    <header>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/releases/index.html">Releases</a></nav>
    </header>
    <main>
    <article>
        <h1 id="release-notes-v00119">
  Release notes v0.0.119
  
</h1>
<p>More breaking changes, results in more release notes. So to do my self a favor,
I should stop doing breaking changes, so I don&#39;t have to write release notes.
Does it work that way? Maybe.</p>
<h2 id="code-gen">
  Code gen
  <a name="code-gen" class="anchor" href="#code-gen">#</a>
</h2>
<p>We are well on our way to enable the JSDoc eslint plugin. At last, the generator
output should now be stable and never trigger an error when the jsdoc rules are
enabled.</p>
<p>There was a bug in the generated sql &#39;where xxxIn&#39; behaviour. The generated
where function would ignore an empty array, that could result in unexpectedly
updating or deleting all rows of a table. In this release, an empty &#39;where
xxxIn&#39; array should result in zero rows updated, deleted or selected.</p>
<p>We now have dynamic <code>ORDER BY</code> support in the sql generator. This works by
accepting an array of columns you want to sort on, and an optional order
specification. Using it would look something like the following:</p>
<pre><code class="language-js"><span class="hljs-comment">// Get users sorted by their age, ascending</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> query<span class="hljs-string">`SELECT * FROM &quot;user&quot; u <span class="hljs-subst">${userOrderBy([<span class="hljs-string">&quot;age&quot;</span>])}</span>`</span>.exec(
  sql,
);

<span class="hljs-comment">// Get users sorted by their age descending, and if multiple users have the same age, on name ascending.</span>
<span class="hljs-comment">// In tis case name is an optional column, so we can specify where the &#x27;null&#x27; values should go.</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> query<span class="hljs-string">`SELECT * FROM &quot;user&quot; u <span class="hljs-subst">${userOrderBy(
  [<span class="hljs-string">&quot;age&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>],
  {
    age: <span class="hljs-string">&quot;DESC&quot;</span>,
    name: <span class="hljs-string">&quot;ASC NULLS FIRST&quot;</span>,
  },
)}</span>`</span>.exec(sql);
</code></pre>
<p>The values that can be put in the &#39;orderBy&#39; and &#39;orderBySpec&#39; arguments, should
be marked as <code>.searchable()</code> in the spec. Of course the query builder also
supports these fields:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> [newestUser] = <span class="hljs-keyword">await</span> queryUser({
  <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;createdAt&quot;</span>],
  <span class="hljs-attr">orderBySpec</span>: [<span class="hljs-string">&quot;DESC&quot;</span>],
  <span class="hljs-attr">posts</span>: {
    <span class="hljs-attr">limit</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;likedCount&quot;</span>],
  },
  <span class="hljs-attr">limit</span>: <span class="hljs-number">1</span>,
}).exec(sql);
</code></pre>
<p>The above would get the &#39;newest&#39; user, with a single post that has the least
likes. The default behaviour is still the same,
<code>orderBy: [&quot;createdAt&quot;, &quot;updatedAt&quot;, &quot;id&quot;]</code>. However, you need to update the
<code>xxxOrderBy</code> calls where you specified for example the <code>tableName</code> argument.</p>
<h2 id="store">
  Store
  <a name="store" class="anchor" href="#store">#</a>
</h2>
<p>We removed the <code>getNestedFileGroup</code> in this release as the query builder has the
same options and more. The only limit is that the new call doesn&#39;t return the
full group depth, but instead you always specify the levels you need.</p>
<p>The following examples illustrate equal behaviour:</p>
<pre><code class="language-js"><span class="hljs-comment">// Old</span>
<span class="hljs-keyword">await</span> getNestedFileGroup(sql, { <span class="hljs-attr">excludeFiles</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// New, get 2 levels of children for all roots, correctly ordered.</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> queryFileGroup({
  <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;order&quot;</span>],
  <span class="hljs-attr">children</span>: {
    <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;order&quot;</span>],
    <span class="hljs-attr">children</span>: {
      <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;order&quot;</span>],
    },
  },
  <span class="hljs-attr">where</span>: {
    <span class="hljs-attr">parentIsNull</span>: <span class="hljs-literal">true</span>,
  },
}).exec(sql);
</code></pre>
<pre><code class="language-js"><span class="hljs-comment">// Old</span>
<span class="hljs-keyword">await</span> getNestedFileGroup(sql, { <span class="hljs-attr">rootId</span>: myFileGroupId });

<span class="hljs-comment">// New, get 1 level of children for the specified &#x27;root&#x27;</span>
<span class="hljs-comment">// and include the file, correctly ordered.</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> queryFileGroup({
  <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;order&quot;</span>],
  <span class="hljs-attr">children</span>: {
    <span class="hljs-attr">orderBy</span>: [<span class="hljs-string">&quot;order&quot;</span>],
    <span class="hljs-attr">file</span>: {},
  },
  <span class="hljs-attr">where</span>: {
    <span class="hljs-attr">id</span>: myFileGroupId,
  },
}).exec(sql);
</code></pre>
<h2 id="in-closing">
  In closing
  <a name="in-closing" class="anchor" href="#in-closing">#</a>
</h2>
<p>That&#39;s it, we are expecting some more breaking changes in the query builder
soon, as we move the <code>viaXxx</code> to the where builder instead. Also if you want to
help design the next few things, pleas take a look at
<a href="https://github.com/compasjs/compas/issues/690">dependencies between routes</a>,
<a href="https://github.com/compasjs/compas/issues/568">consistent &amp; validated JSDoc</a> or
<a href="https://github.com/compasjs/compas/issues/574">integrating OpenAPI 3 a bit more</a>.</p>

    </article>
    
    </main>
    <footer>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/releases/index.html">Releases</a></nav>
    </footer>
    </body>
</html>
  