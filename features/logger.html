
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
        <title>Logger</title>
        <meta name="description" content="Compas logger"/>
        <link rel="canonical" href="https://compasjs.com/features/logger.html"/>
        <style>
            body {margin: 5% auto; background: #f2f2f2; color: #444444; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.8; text-shadow: 0 1px 0 #ffffff; max-width: 73%;}
            pre, code {background: white;}
            pre {padding-left: 2px; line-height: 1.2; }
            code {margin-left: 2px; margin-right: 2px; }
            a {border-bottom: 1px solid #444444; color: #444444; text-decoration: none;}
            a:hover {border-bottom: 0;}
            .hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs,.hljs-subst{color:#444}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#bc6060}.hljs-literal{color:#78a960}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta-string{color:#4d99bf}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}
        </style>
    </head>
    <body>
    <header>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/features/index.html">Features</a></nav>
    </header>
    <main>
    <article>
        <h1 id="logger">Logger</h1>
<p>Although the insight package exports more than just a logger, this document will
focus on the logger.</p>
<h2 id="api">API</h2>
<p>Provided by <code>@compas/insight</code></p>
<h3 id="newlogger">newLogger</h3>
<p>This function constructs a new logger. The logger supports a log context and
pretty printing when asked.</p>
<p>Parameters:</p>
<ul>
<li><code>options</code>:<ul>
<li><code>pretty</code> (boolean): Use the pretty printer. Defaults to true when
<code>process.env.NODE_ENV</code> is <code>development</code>.</li>
<li><code>stream</code> (Stream): The stream to write to, defaults to <code>process.stdout</code>.
This is the intended use case. Although streams to files may work, this is
not supported.</li>
<li><code>ctx</code> (object): Any context to add to log lines. This value is immediately
copied on logger creation, so changes made via a reference, will not be
reflected.</li>
</ul>
</li>
</ul>
<p>A logger is a plain JavaScript object with 3 functions:</p>
<p><strong>info</strong> and <strong>error</strong>:</p>
<p>The info and error function accept a single argument that is logged. This
happens in a single <code>write</code> call when pretty printing or not.</p>
<p><strong>isProduction</strong></p>
<p>Check if the logger is pretty printing or not. This may be useful to add some
formatting to values. For example when loggin a file size, you may want the
number of bytes in production, but when developing want to see <code>8 kB</code>.</p>
<h2 id="on-log-levels-and-processing">On log levels and processing</h2>
<p>Log levels are often used to get some ranking based on importance in your log
lines. Compas only knows 2 log levels: info and error. A log line is either
important enough to warn you, or it is not. By simplifying this decision, you
can spend a bit more time deciding if you really need to log that information or
not.</p>
<p>There is much more information in logs than just the contrasting error- and
info-&#39;level&#39;, however this always requires further processing. Compas prefers
that this happens outside the current process. That is why by default we write
everything to <code>stdout</code>. To accommodate processing, every log line is a valid
JSON string, also called newline delimited JSON or NDJSON for short. The log
line is structured as follows:</p>
<pre><code class="language-json5">// Created with `log.info({ hello: &quot;world&quot; });`
{
  // The log level, either &#x27;info&#x27; or &#x27;error&#x27;
  level: &quot;info&quot;,
  // Current date and time formatted as ISO8601-string
  timestamp: &quot;2021-01-19T21:17:11.693Z&quot;,
  // The `ctx` that is passed in `newLogger`
  // In this case the default by `mainFn` from `@compas/stdlib`
  context: {
    // File name without extension
    type: &quot;api&quot;,
    // Value of process.env.APP_NAME, see environment variable docs
    application: &quot;compas&quot;,
  },
  // The value passed in to the log function
  // So can be an object, array, string, boolean, ...
  message: {
    hello: &quot;world&quot;,
  },
}
</code></pre>
<p>The log-processor can take these lines and do whatever is needed to check on
&#39;indirect&#39; errors like a spike of unauthorized requests.</p>

    </article>
    
    </main>
    <footer>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/features/index.html">Features</a></nav>
    </footer>
    </body>
</html>
  