
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
        <title>Project setup</title>
        <meta name="description" content="Setup Compas stdlib and get to know mainFn"/>
        <link rel="canonical" href="https://pre.compasjs.com/setup/project-setup.html"/>
        <style>
            body {margin: 5% auto; background: #f2f2f2; color: #444444; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.8; text-shadow: 0 1px 0 #ffffff; max-width: 73%;}
            pre, code {background: white;}
            pre {padding-left: 2px; line-height: 1.2; }
            code {margin-left: 2px; margin-right: 2px; }
            a {border-bottom: 1px solid #444444; color: #444444; text-decoration: none;}
            a:hover {border-bottom: 0;}
            .hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs,.hljs-subst{color:#444}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#bc6060}.hljs-literal{color:#78a960}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta-string{color:#4d99bf}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}
        </style>
    </head>
    <body>
    <header>
        <nav><a href="https://pre.compasjs.com/index.html">Compas</a> > <a href="https://pre.compasjs.com/setup/index.html">Project setup</a></nav>
    </header>
    <main>
    <article>
        <h1 id="project-setup">Project setup</h1>
<p>This series of setup documents explains the setup used in Node.js &amp; Compas based
backends.</p>
<p>Let&#39;s start with creating a new project, in these docs <code>compas-todo</code>. Create a
new directory and open a terminal in that directory. Compas projects use
<a href="https://nodejs.org/dist/latest-v15.x/docs/api/esm.html#esm_introduction">ES modules</a>.
This results in projects created on top of Compas, to also use ES modules.</p>
<p>To enable this, make sure to use Node.js 14 or higher and create the following
package.json file:</p>
<pre><code class="language-json">{
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;compas-todo&quot;</span>,
  <span class="hljs-attr">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;module&quot;</span>
}</code></pre>
<p>Another useful file to create now, is a <code>.env</code> file with the following contents:</p>
<pre><code class="language-dotenv">NODE_ENV=development</code></pre>
<p>This changes some defaults, for example pretty printing in the logger.</p>
<h2 id="stdlib">Stdlib</h2>
<p>A package provided by Compas is <code>@compas/stdlib</code>. This contains various small
utility functions, like recursively looping over all files in a directory.</p>
<blockquote>
<p>All commands provided here use Yarn v1. However, using NPM (via the <code>npm</code> and
<code>npx</code>) commands should work as well.</p>
</blockquote>
<p>Installing Compas packages works exactly like you would expect:</p>
<pre><code class="language-shell">yarn add @compas/stdlib --exact</code></pre>
<p>An often used utility provided by the stdlib is <code>mainFn</code>. This does a few
things:</p>
<ul>
<li>Only runs if the file that you call <code>mainFn</code> in, is the &#39;main&#39; file</li>
<li>Reads the <code>.env</code> file if exists</li>
<li>Calls the provided callback, and handles uncaught exceptions.</li>
<li>Create a logger from <a href="TODO">@compas/insight</a></li>
</ul>
<p>Let&#39;s create two files. Both exporting a constant and calling <code>mainFn</code>:</p>
<pre><code class="language-js"><span class="hljs-comment">// src/a.js</span>
<span class="hljs-keyword">import</span> { mainFn } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@compas/stdlib&quot;</span>;
<span class="hljs-keyword">import</span> { b } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./b.js&quot;</span>;

mainFn(<span class="hljs-keyword">import</span>.meta, <span class="hljs-function">(<span class="hljs-params">logger</span>) =&gt;</span> logger.info(<span class="hljs-string">&quot;Hello from a.js. B is&quot;</span>, b));

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-literal">true</span>;

<span class="hljs-comment">// src/b.js</span>
<span class="hljs-keyword">import</span> { mainFn } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@compas/stdlib&quot;</span>;
<span class="hljs-keyword">import</span> { a } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./a.js&quot;</span>;

mainFn(<span class="hljs-keyword">import</span>.meta, <span class="hljs-function">(<span class="hljs-params">logger</span>) =&gt;</span> logger.info(<span class="hljs-string">&quot;Hello from b.js. A is&quot;</span>, a));

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-literal">false</span>;</code></pre>
<p>Now if we run <code>src/a.js</code>, we see the following:</p>
<pre><code class="language-txt">$ node ./src/a.js
Hello from a.js. B is false</code></pre>
<p>When running <code>src/b.js</code>:</p>
<pre><code class="language-txt">$ node ./src/b.js
Hello from b.js. A is true</code></pre>
<p>As you can see in the output, only a single callback passed to <code>mainFn</code> is
called. This callback in <code>src/a.js</code> only being called when it is the starting
point of your program, ie started via <code>node ./src/a.js</code>. Consequently, the
callback passed in <code>src/b.js</code> is only called when you start your program with
<code>node ./src/b.js</code>.</p>
<p>Congrats! Your first Compas based project is alive :) The next steps cover a few
other essentials like linting, testing, setting up an HTTP server, connecting to
Postgres and finalizes with setting up the code generators.</p>

    </article>
    
    </main>
    <footer>
        <nav><a href="https://pre.compasjs.com/index.html">Compas</a> > <a href="https://pre.compasjs.com/setup/index.html">Project setup</a></nav>
    </footer>
    </body>
</html>
  