
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
        <title>Services setup</title>
        <meta name="description" content="Setup reusable services"/>
        <link rel="canonical" href="https://compasjs.com/setup/services-setup.html"/>
        <style>
            body {margin: 5% auto; background: #f2f2f2; color: #444444; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.8; text-shadow: 0 1px 0 #ffffff; max-width: 73%;}
            pre, code {background: white;}
            pre {padding-left: 2px; line-height: 1.2; }
            code {margin-left: 2px; margin-right: 2px; }
            a {border-bottom: 1px solid #444444; color: #444444; text-decoration: none;}
            a:hover {border-bottom: 0;}
            a.anchor { float: right; text-decoration: none; padding: 1px 3px; border-bottom: none; }
            .hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs,.hljs-subst{color:#444}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#bc6060}.hljs-literal{color:#78a960}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta-string{color:#4d99bf}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}
        </style>
    </head>
    <body>
    <header>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/setup/index.html">Project setup</a></nav>
    </header>
    <main>
    <article>
        <h1 id="services-setup">
  Services setup
  
</h1>
<p>A lot of the time you have variables that need a setup, and are then long-lived
while your server is running. A pattern that was often used is to use
singletons, or directly exported values.</p>
<p>This pattern makes testing hard, as these values are not replaceable or mockable
anymore. Because all places use it directly. It also introduces some mental
gymnastics, because primitives like a number behaved differently when required,
than an object.</p>
<h2 id="es-module-live-bindings">
  ES Module live bindings
  <a name="es-module-live-bindings" class="anchor" href="#es-module-live-bindings">#</a>
</h2>
<p>Enter ES Module live bindings. ES Module live bindings allow you to export a
variable and in the same file replace it. Let&#39;s look at an example.</p>
<p>Create the following file in <code>src/services/counter.js</code></p>
<pre><code class="language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> counter = <span class="hljs-literal">undefined</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setCounter</span>(<span class="hljs-params">newValue</span>) {
  counter = newValue;
}
</code></pre>
<p>Then using it would look like the following:</p>
<pre><code class="language-js"><span class="hljs-keyword">import</span> { counter, setCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./serverices/counter.js&quot;</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter); <span class="hljs-comment">// undefined</span>
<span class="hljs-title function_">setCounter</span>(<span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter); <span class="hljs-comment">// 5</span>
</code></pre>
<p>As you can see, code can use the imported variable directly when doing read
operations. When exporting a &#39; setXx&#39;-function, you can replace the variable
anytime; when your application is starting up, or replacing it with a mock when
testing.</p>

    </article>
    
    </main>
    <footer>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/setup/index.html">Project setup</a></nav>
    </footer>
    </body>
</html>
  