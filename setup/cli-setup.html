
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
        <title>CLI and linting</title>
        <meta name="description" content="Setup Compas based lint configuration and get to know the CLI"/>
        <link rel="canonical" href="https://compasjs.com/setup/cli-setup.html"/>
        <style>
            body {margin: 5% auto; background: #f2f2f2; color: #444444; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.8; text-shadow: 0 1px 0 #ffffff; max-width: 73%;}
            pre, code {background: white;}
            pre {padding-left: 2px; line-height: 1.2; }
            code {margin-left: 2px; margin-right: 2px; }
            a {border-bottom: 1px solid #444444; color: #444444; text-decoration: none;}
            a:hover {border-bottom: 0;}
            .hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs,.hljs-subst{color:#444}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#bc6060}.hljs-literal{color:#78a960}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta-string{color:#4d99bf}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}
        </style>
    </head>
    <body>
    <header>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/setup/index.html">Project setup</a></nav>
    </header>
    <main>
    <article>
        <h1 id="setting-up-the-cli-and-linting">Setting up the CLI and linting</h1>
<p>Of course a project needs linting and Compas provides a 2-step approach:</p>
<ul>
<li>Lint configuration via <code>@compas/lint-config</code></li>
<li>Running the linter via <code>@compas/cli</code></li>
</ul>
<p>Start with installing the dependencies:</p>
<pre><code class="language-shell">yarn add @compas/lint-config @compas/cli --exact --dev</code></pre>
<h2 id="configuration">Configuration</h2>
<p>The <code>@compas/lint-config</code> package provides a Prettier config and ESLint
configuration. To get the configuration in your project, create the following
three files:</p>
<p><strong>/.eslintrc.cjs</strong></p>
<pre><code class="language-js"><span class="hljs-comment">/* eslint-disable import/no-commonjs */</span>

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">&quot;./node_modules/@compas/lint-config&quot;</span>],
  <span class="hljs-attr">root</span>: <span class="hljs-literal">true</span>,
};</code></pre>
<p><strong>/.prettierrc.cjs</strong></p>
<pre><code class="language-js"><span class="hljs-comment">/* eslint-disable import/no-commonjs */</span>

<span class="hljs-built_in">module</span>.exports = {
  ...require(<span class="hljs-string">&quot;@compas/lint-config/prettierrc.js&quot;</span>),
};</code></pre>
<p><strong>/.prettierignore</strong></p>
<pre><code class="language-ignorelang">coverage/**</code></pre>
<p>This way you should be able to easily override any configuration if necessary.
By following the respective guides / configuration options:</p>
<ul>
<li><a href="https://eslint.org/docs/user-guide/configuring#configuring-rules">ESLint</a></li>
<li><a href="https://prettier.io/docs/en/options.html">Prettier</a></li>
<li><a href="https://github.com/benmosher/eslint-plugin-import/">eslint-plugin-import</a></li>
</ul>
<p>Now is also a good time to set up your IDE to use your local configuration.</p>
<h2 id="running-the-linter">Running the linter</h2>
<p>At the moment we have only configured the underlying tools but have not run
anything yet. This is where <code>@compas/cli</code> comes in. This package also has a
range of features, but for now we focus on two of them. Let&#39;s start with running
the linters:</p>
<pre><code class="language-shell">yarn compas lint</code></pre>
<blockquote>
<p>When using NPM use <code>npx compas lint</code></p>
</blockquote>
<p>This runs both ESLint and Prettier in auto fix mode over your Javascript files.
Prettier will also look at plain JSON and Markdown files.</p>
<p>There is also an environment variable available that runs Prettier in &#39;check&#39;
mode. This way it will only report errors and not run the auto fixer. This can
be enabled by setting <code>CI=true</code>:</p>
<pre><code class="language-shell">export CI=true
yarn compas lint
unset CI</code></pre>
<p>This environment variable is also document in <a href="TODO">Environment variables</a></p>
<h2 id="running-scripts">Running scripts</h2>
<p>The <code>@compas/cli</code> package also comes with more features. Some of these will be
explored in later parts of this setup guide. For now, we will take a look at the
script runner.</p>
<p>The script runner at its base starts your scripts the same way as you would with
Node.js.</p>
<pre><code class="language-shell">yarn compas ./src/a.js
<span class="hljs-meta">#</span><span class="bash"> Is the same as `node ./src/a.js`</span></code></pre>
<p>However, it can also run named scripts. It will look for scripts defined in your
<code>package.json</code> and in the <code>scripts</code> directory at the root of your project.
Create a file in <code>scripts/hello.js</code> with the following contents:</p>
<pre><code class="language-js"><span class="hljs-keyword">import</span> { mainFn } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@compas/stdlib&quot;</span>;

mainFn(<span class="hljs-keyword">import</span>.meta, main);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params">logger</span>) </span>{
  logger.info(<span class="hljs-string">&quot;Hello!&quot;</span>);
}</code></pre>
<p>When running <code>yarn compas help</code> it should list <code>hello</code> under the available
script names. Let&#39;s run it:</p>
<pre><code class="language-shell">yarn compas hello
<span class="hljs-meta">#</span><span class="bash"> Is the same as</span>
yarn compas run hello</code></pre>
<p>As you may have seen in the output from <code>yarn compas help</code>, there is also a
<code>--watch</code> flag. This flag can be used when specifying a path, but also when
running a &#39;named&#39; script.</p>
<p>Let&#39;s start our <code>hello</code> script in watch-mode:</p>
<pre><code class="language-shell">yarn compas --watch hello</code></pre>
<p>Now when making any changes to the log line and saving, you should see the
script being restarted. If you just want to restart, type in <code>rs</code> and press
enter in your terminal. By default, all your JavaScript files are watched. This
is customizable via the <a href="TODO">watch options</a>.</p>

    </article>
    
    </main>
    <footer>
        <nav><a href="https://compasjs.com/index.html">Compas</a> > <a href="https://compasjs.com/setup/index.html">Project setup</a></nav>
    </footer>
    </body>
</html>
  