
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
        <title>Compas</title>
        <meta name="description" content="Unified backend tooling"/>
        <link rel="canonical" href="https://compasjs.com/index.html"/>
        <style>
            body {margin: 5% auto; background: #f2f2f2; color: #444444; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.8; text-shadow: 0 1px 0 #ffffff; max-width: 73%;}
            pre, code {background: white;}
            pre {padding-left: 2px; line-height: 1.2; }
            code {margin-left: 2px; margin-right: 2px; }
            a {border-bottom: 1px solid #444444; color: #444444; text-decoration: none;}
            a:hover {border-bottom: 0;}
            a.anchor { float: right; text-decoration: none; padding: 1px 3px; border-bottom: none; }
            .hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs,.hljs-subst{color:#444}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-selector-tag{font-weight:700}.hljs-deletion,.hljs-number,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#800}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#bc6060}.hljs-literal{color:#78a960}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta-string{color:#4d99bf}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}
        </style>
    </head>
    <body>
    <header>
        <nav></nav>
    </header>
    <main>
    <article>
        <h1 id="compas">
  Compas
  
</h1>
<p>Unified backend tooling</p>
<hr>
<h2 id="features">
  Features
  <a name="features" class="anchor" href="#features">#</a>
</h2>
<ul>
<li>Script and test runner with built-in watcher</li>
<li>Flexible code generators supporting routers, validators, api clients and
Postgres queries</li>
<li>Structured logger</li>
<li>Common utilities like session handling, job queue, file storage and loading
&#39;.env&#39; files</li>
</ul>
<h2 id="requirements">
  Requirements
  <a name="requirements" class="anchor" href="#requirements">#</a>
</h2>
<ul>
<li>Node.js &gt;= 15</li>
<li>Yarn 1.x.x</li>
</ul>
<h2 id="im-a">
  I&#39;m a...
  <a name="im-a" class="anchor" href="#im-a">#</a>
</h2>
<ul>
<li><a href="/#backend-developer">Backend developer</a></li>
<li><a href="/#frontend-developer">Frontend developer</a></li>
<li><a href="/todo.md">Manager</a></li>
</ul>
<h3 id="backend-developer">
  Backend developer
  <a name="backend-developer" class="anchor" href="#backend-developer">#</a>
</h3>
<p>Provide the HTTP api structure:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> T = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeCreator</span>(<span class="hljs-string">&quot;todo&quot;</span>);
<span class="hljs-keyword">const</span> R = T.<span class="hljs-title function_">router</span>(<span class="hljs-string">&quot;/todo&quot;</span>);

R.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/list&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>).<span class="hljs-title function_">response</span>({
  <span class="hljs-attr">todos</span>: [
    {
      <span class="hljs-attr">id</span>: T.<span class="hljs-title function_">uuid</span>(),
      <span class="hljs-attr">todo</span>: T.<span class="hljs-title function_">string</span>(),
      <span class="hljs-attr">completed</span>: T.<span class="hljs-title function_">boolean</span>(),
    },
  ],
});
</code></pre>
<p>Add an implementation:</p>
<pre><code class="language-js">todoHandlers.<span class="hljs-property">list</span> = <span class="hljs-keyword">async</span> (ctx, next) =&gt; {
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">todo</span>: [
      {
        <span class="hljs-attr">id</span>: <span class="hljs-title function_">uuid</span>(),
        <span class="hljs-attr">todo</span>: <span class="hljs-string">&quot;Explore compas&quot;</span>,
      },
    ],
  };

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();
};
</code></pre>
<p>Create a test:</p>
<pre><code class="language-js"><span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;todo/controller&quot;</span>, <span class="hljs-keyword">async</span> (t) =&gt; {
  <span class="hljs-keyword">const</span> apiClient = <span class="hljs-title class_">Axios</span>.<span class="hljs-title function_">create</span>({});
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createTestAppAndClient</span>(app, apiClient);

  t.<span class="hljs-title function_">test</span>(<span class="hljs-string">&quot;list conforms to response structure&quot;</span>, <span class="hljs-keyword">async</span> (t) =&gt; {
    <span class="hljs-keyword">await</span> todoApi.<span class="hljs-title function_">list</span>();
    <span class="hljs-comment">// Throws: validator.response.todo.list.boolean.type -&gt; Missing boolean value at &#x27;$.todo[0].completed&#x27;</span>
  });
});
</code></pre>
<p>And some icing on the cake, by generating some PostgreSQL queries:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> T = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeCreator</span>(<span class="hljs-string">&quot;database&quot;</span>);

T.<span class="hljs-title function_">object</span>(<span class="hljs-string">&quot;user&quot;</span>)
  .<span class="hljs-title function_">keys</span>({
    <span class="hljs-attr">email</span>: T.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">searchable</span>(),
    <span class="hljs-attr">name</span>: T.<span class="hljs-title function_">string</span>(),
  })
  .<span class="hljs-title function_">enableQueries</span>({
    <span class="hljs-attr">withDates</span>: <span class="hljs-literal">true</span>,
  })
  .<span class="hljs-title function_">relations</span>(T.<span class="hljs-title function_">oneToMany</span>(<span class="hljs-string">&quot;posts&quot;</span>, T.<span class="hljs-title function_">reference</span>(<span class="hljs-string">&quot;database&quot;</span>, <span class="hljs-string">&quot;post&quot;</span>)));

T.<span class="hljs-title function_">object</span>(<span class="hljs-string">&quot;post&quot;</span>)
  .<span class="hljs-title function_">keys</span>({
    <span class="hljs-attr">title</span>: T.<span class="hljs-title function_">string</span>(),
    <span class="hljs-attr">body</span>: T.<span class="hljs-title function_">string</span>(),
  })
  .<span class="hljs-title function_">enableQueries</span>({
    <span class="hljs-attr">withSoftDeletes</span>: <span class="hljs-literal">true</span>,
  })
  .<span class="hljs-title function_">relations</span>(T.<span class="hljs-title function_">manyToOne</span>(<span class="hljs-string">&quot;author&quot;</span>, T.<span class="hljs-title function_">reference</span>(<span class="hljs-string">&quot;database&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>), <span class="hljs-string">&quot;posts&quot;</span>));
</code></pre>
<p>With queries like the following:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> [user] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">queryUser</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;foo@bar.com&quot;</span> } }).<span class="hljs-title function_">exec</span>(sql);
<span class="hljs-keyword">const</span> usersWithPosts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">queryUser</span>({ <span class="hljs-attr">posts</span>: {} }).<span class="hljs-title function_">exec</span>(sql);

<span class="hljs-keyword">const</span> postsForAuthor = <span class="hljs-keyword">await</span> <span class="hljs-title function_">queryPost</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">author</span>: user.<span class="hljs-property">id</span> } }).<span class="hljs-title function_">exe</span>(sql);
<span class="hljs-keyword">const</span> [authorOfPost] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">queryUser</span>({
  <span class="hljs-attr">viaPosts</span>: { <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: postsForAuthor[<span class="hljs-number">0</span>].<span class="hljs-property">id</span> } },
}).<span class="hljs-title function_">exec</span>(sql);
<span class="hljs-comment">// postsForAuthor[0].author == authorOfPost.id</span>

<span class="hljs-keyword">await</span> queries.<span class="hljs-title function_">userInsert</span>(sql, { <span class="hljs-attr">email</span>: <span class="hljs-string">&quot;bar@foo.com&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Compas &quot;</span> });

<span class="hljs-comment">// soft delete</span>
<span class="hljs-keyword">await</span> queries.<span class="hljs-title function_">postDelete</span>(sql, { <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;c532ac2a-4489-4b50-a061-12b2aa9a5df2&quot;</span> });
<span class="hljs-comment">// Search include soft deleted posts</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">queryPost</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">deletedAtIncludeNotNull</span>: <span class="hljs-literal">true</span> } });
<span class="hljs-comment">// permanent delete</span>
<span class="hljs-keyword">await</span> queries.<span class="hljs-title function_">postDeletePermanent</span>(sql, {
  <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;c532ac2a-4489-4b50-a061-12b2aa9a5df2&quot;</span>,
});
</code></pre>
<h3 id="frontend-developer">
  Frontend developer
  <a name="frontend-developer" class="anchor" href="#frontend-developer">#</a>
</h3>
<p>Either import from a Compas server:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">App</span>();
app.<span class="hljs-title function_">extend</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">loadFromRemote</span>(<span class="hljs-title class_">Axios</span>, <span class="hljs-string">&quot;https://api.my-domain.com&quot;</span>));
app.<span class="hljs-title function_">generate</span>({
  <span class="hljs-attr">outputDirectory</span>: <span class="hljs-string">&quot;./src/generated&quot;</span>,
  <span class="hljs-attr">isBrowser</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
<p>Or import from an OpenAPI spec (alpha-quality :S):</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">App</span>();
app.<span class="hljs-title function_">extendWithOpenApi</span>(<span class="hljs-string">&quot;todo&quot;</span>, <span class="hljs-title function_">getAnOpenAPISpecAsPlainJavascriptObject</span>());
app.<span class="hljs-title function_">generate</span>({
  <span class="hljs-attr">outputDirectory</span>: <span class="hljs-string">&quot;./src/generated&quot;</span>,
  <span class="hljs-attr">isBrowser</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
<p>And use the typed api client:</p>
<pre><code class="language-ts"><span class="hljs-keyword">const</span> <span class="hljs-attr">todos</span>: <span class="hljs-title class_">TodoListResponse</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiTodoList</span>();
</code></pre>
<p>Or use the generated react-query hooks:</p>
<pre><code class="language-tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">renderTodo</span>(<span class="hljs-params">{ todoId }: TodoSingleParams</span>) {
  <span class="hljs-comment">// Generated react-query hook with typed results</span>
  <span class="hljs-keyword">const</span> { data } = <span class="hljs-title function_">useTodoSingle</span>({ todoId });

  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/*...*/}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h2 id="how-it-works">
  How it works
  <a name="how-it-works" class="anchor" href="#how-it-works">#</a>
</h2>
<p>Most of the above is achieved by a custom specification, a few code generators
and a bunch of time tweaking results to achieve a stable way of working. Which
benefits backend developers with less copy-pasting, easy &#39;interface&#39;-testing and
less manual doc writing, and frontend developers with explorable and ready to
consume api&#39;s.</p>
<h2 id="why">
  Why
  <a name="why" class="anchor" href="#why">#</a>
</h2>
<p>My work involved doing many small projects. I had a hard time backporting
incremental fixes to existing projects. To facilitate my needs more and to stop
copying and pasting things around, this project was born.</p>
<h2 id="docs-and-development">
  Docs and development
  <a name="docs-and-development" class="anchor" href="#docs-and-development">#</a>
</h2>
<p>See <a href="https://compasjs.com">the website</a> for the
<a href="https://compasjs.com/changelog.html">changelog</a>, all available APIs and various
guides.</p>
<p>For contributing see <a href="https://compasjs.com/contributing.html">contributing</a>.</p>
<h2 id="new-features">
  New features
  <a name="new-features" class="anchor" href="#new-features">#</a>
</h2>
<p>New features added should fall under the following categories:</p>
<ul>
<li>It improves the interface between api and client in some way. An example may
be to support websockets in @compas/code-gen</li>
<li>It improves the developer experience one way or another while developing an
api For example the <code>compas docker</code> commands or various utilities provided by
@compas/stdlib</li>
</ul>
<p>Although some parts heavily rely on conventions set by the packages, we
currently aim not to be a framework. We aim to provide a good developer
experience, useful abstractions around the basics, and a stable backend &lt;-&gt;
client interface.</p>

    </article>
    <hr><article><ul><li><a href="https://compasjs.com/setup/index.html">Project setup</a></li><li><a href="https://compasjs.com/features/index.html">Features</a></li><li><a href="https://compasjs.com/api/index.html">API Documentation</a></li><li><a href="https://compasjs.com/changelog.html">Changelog</a></li><li><a href="https://compasjs.com/releases/index.html">Releases</a></li><li><a href="https://compasjs.com/contributing.html">Contributing</a></li></ul></article>
    </main>
    <footer>
        <nav></nav>
    </footer>
    </body>
</html>
  